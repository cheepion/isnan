---
title: "useRef åº”ç”¨åœºæ™¯"
subTitle: "ç›®çš„: 1 æä¾›å¯¹DOMå…ƒç´ çš„å¼•ç”¨, 2 è¿”å›å¯å˜å€¼ï¼Œè¯¥å¯å˜å€¼åœ¨æ¸²æŸ“å™¨ä¸­æŒä¹…"
date: "2020-07-30"
icon: "faReact"
type: "react"
headImg: "https://cdn.hashnode.com/res/hashnode/image/upload/v1613217734286/l26vCJqYM.jpeg?w=1600&h=840&fit=crop&crop=entropy&auto=compress"
---

å‡å®šæ‚¨äº†è§£Reactçš„åŸºæœ¬çŸ¥è¯†å’ŒçŸ¥è¯†`useState`ã€‚

> [é˜…è¯»æˆ‘çš„æ–‡ç« ï¼Œäº†è§£åº”ç”¨ç¨‹åºçš„çŠ¶æ€æ˜¯ä»€ä¹ˆï¼Ÿå’ŒuseStateé’©å­](https://shubhs.hashnode.dev/usestate-like-a-pro)ï¼ˆæœ‰ä¸€ä¸ªTL; DRéƒ¨åˆ†ï¼Œå¦‚æœæ‚¨æƒ³å¿«é€Ÿçœ‹ä¸€ä¸‹ğŸ˜‰ï¼‰ï¼Œé‚£ä¹ˆåœ¨æ­¤åšå®¢ä¸­å°†éœ€è¦ä¸€äº›ä¸çŠ¶æ€ç›¸å…³çš„æ¦‚å¿µã€‚

## ä»€ä¹ˆ`useRef`å•Š

> Refåªæ˜¯ä¸€ä¸ª`{ current: initialValue }`å¯¹è±¡ã€‚æ²¡ä»€ä¹ˆç‰¹åˆ«çš„ åŒæ–¹`useRef(initivalValue)`å¹¶`createRef()`ç»™ä½ çš„ã€‚

```javascript
function useRef(initialValue) {
  // useRef works more like this
  return React.useState({
    current: initialValue
  })[0]
}
```

> æ‚¨åªæ˜¯åˆ›å»ºäº†è‡ªå·±çš„`useRef`ã€‚

## æˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦`useRef`ï¼Ÿ

`useRef` å®é™…ä¸Šæœ‰ä¸¤ä¸ªç›®çš„

- æä¾›å¯¹DOMå…ƒç´ çš„å¼•ç”¨
- è¿”å›å¯å˜å€¼ï¼Œè¯¥å¯å˜å€¼åœ¨æ¸²æŸ“å™¨ä¸­æŒä¹…

### ä½†æ˜¯ï¼Œè¿™ç§å¯å˜å’ŒæŒä¹…çš„ä»·å€¼æ˜¯ä»€ä¹ˆï¼Ÿ

æŒä¹…å€¼æ˜¯ä¸€ç§åœ¨**æ¸²æŸ“**ä¹‹é—´ä¿æŒæŒä¹…çš„å€¼ï¼Œå³`useState`è¿”å›å€¼ï¼ŒæŒä¹…å€¼ï¼ˆ`state`ï¼‰å’Œæ›´æ–°ç¨‹åºAPIï¼ˆ`setState`ï¼‰æ¥æ›´æ–°è¯¥çŠ¶æ€ï¼Œä»è€Œå¯¼è‡´è¯¥ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ã€‚ä¸ºä½¿åº”ç”¨ç¨‹åºæ›´æ–°å…¶Viewï¼ˆUIï¼‰ï¼Œæ‚¨éœ€è¦è¯¥setState APIã€‚

### ä½†æ˜¯ï¼Œå¦‚æœæ‚¨å¸Œæœ›æ‹¥æœ‰ä¸€ä¸ªæŒä¹…çš„å€¼å¹¶ä¸”ä¸ä¼šå¯¼è‡´ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ï¼Œé‚£è¯¥æ€ä¹ˆåŠã€‚

è¿™æ˜¯åŸºæœ¬éœ€æ±‚ï¼Œreactä¸ºæ­¤æä¾›äº†å†…ç½®çš„APIï¼Œè¿™å°±æ˜¯**useRefçš„**ç›®çš„ã€‚

------

## useRef

```javascript
// you can set any type of data as initialValue same as useState()
const objectWithCurrentProperty = React.useRef(initialValue)

const refOne = React.useRef() // returns {current : undefined}
const refTwo = React.useRef(1) // returns {current : 1}
const refThree = React.useRef([]) //returns {current : []}
```

`useRef`å°†åˆå§‹å€¼ç”¨ä½œè¿”å›å€¼çš„å‚æ•°ã€‚è¿™äº›è¿”å›å€¼å°†è¢«ä¿ç•™ï¼Œæ‚¨ä¹Ÿå¯ä»¥æ ¹æ®éœ€è¦å¯¹å…¶è¿›è¡Œçªå˜ã€‚

## ä½¿ç”¨useRefè®¿é—®DOM

æœ‰ä¸€äº›éœ€è¦è®¿é—®domçš„åº“ï¼ˆä¾‹å¦‚Three.jsæˆ–Anime.jsï¼‰ã€‚å½“æˆ‘ä»¬ç¼–å†™jsxæ—¶ï¼Œå®ƒå°†è½¬æ¢ä¸ºReact.createElementã€‚ä¸€ä¸ª`<div>Hello World</div>`æˆ‘ä»¬å†™çš„JSXè¢«è½¬æ¢æˆ`React.createElement("div", null, "Hello World")`è¿™æ ·ä½ å°±ä¸å¿…ä»è¿”å›JSXçš„DOMèŠ‚ç‚¹çš„ä»»ä½•ç›´æ¥è®¿é—®ã€‚

å› æ­¤ï¼Œè¦è®¿é—®DOMï¼Œæ‚¨éœ€è¦è®©Reactåœ¨å‘ˆç°ç»„ä»¶æ—¶å…è®¸æ‚¨è®¿é—®ç‰¹å®šçš„DOMèŠ‚ç‚¹ã€‚å‘ç”Ÿè¿™ç§æƒ…å†µçš„æ–¹å¼æ˜¯é€šè¿‡ç§°ä¸ºçš„ç‰¹æ®Šé“å…·`ref`ã€‚

```javascript
function UploadButton({ handleUpload }) {
  const inputRef = React.useRef();

  const handleClick = () => inputRef.current.click();

  return (
    <>
      <input type="file" hidden ref={inputRef} onInput={handleUpload} />
      <button onClick={handleClick}>Upload</button>
    </>
  );
}
```

åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†`ref`propä¼ é€’`inputRef`ç»™*éšè—æ–‡ä»¶*è¾“å…¥ï¼Œå¹¶ä¸”å½“æˆ‘ä»¬å•å‡»`inputRef.current`ç”¨äºè®¿é—®è¯¥è¾“å…¥çš„**DOMå…ƒç´ **çš„æŒ‰é’®ä»¥åŠè¯¥å…ƒç´ ä¸Šçš„æŒ‰é’®æ—¶ï¼Œæˆ‘ä»¬æ­£åœ¨è°ƒç”¨`click`äº‹ä»¶ã€‚

å…¶ä»–ä¸€äº›æƒ…å†µä¾‹å¦‚æ˜¯ä»è¾“å…¥ä¸­è·å–å€¼ï¼Œæ›´æ”¹ç„¦ç‚¹æˆ–é€‰æ‹©æ–‡æœ¬ã€‚

> react-hook-formæ˜¯ä¸€ä¸ªè¡¨å•åº“ï¼Œå®ƒé¼“åŠ±ä»¥[ä¸å—æ§åˆ¶çš„](https://reactjs.org/docs/uncontrolled-components.html)æ–¹å¼å¤„ç†è¡¨å•ï¼Œå¹¶`ref`æ”¯æŒåœ¨reactç»„ä»¶ä¸­å¤„ç†è¡¨å•ï¼Œè¯·å°è¯•ä¸€ä¸‹å®ƒã€‚

## å¯å˜æ•°æ®å­˜å‚¨

åœ¨æˆ‘ä»¬è¯•å›¾ç†è§£è¿™æ˜¯ä»€ä¹ˆä¹‹å‰ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦å®ƒï¼Ÿå¦‚æœå¯ä»¥ï¼Œæˆ‘å»ºè®®æ‚¨[åˆ›å»º](https://react.new/)ä¸€ä¸ªå…·æœ‰ç§’è¡¨åŠŸèƒ½çš„ç§’è¡¨ç»„ä»¶ã€‚ 
ã€‚
ã€‚
ã€‚
æå‰å‰§é€...... 
ã€‚
ã€‚
ã€‚

```js
// Here is a simple StopWatch component which updates time every 1 second
function StopWatch() {
  const [time, setTime] = useState(0);

  useEffect(() => {
      const interval = setInterval(() => {
        setTime((s) => s + 1);
      }, 1000);

      // clearInterval before unmounting component 
      return () => clearInterval(interval);
  }, []);

  return (<div>{time}</div>);
}
```

ä½†æ˜¯ç°åœ¨æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæŒ‰é’®æ¥åœæ­¢å’Œæ¢å¤æ—¶é—´æ»´ç­”ï¼Œä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†æ·»åŠ æ»´ç­”çŠ¶æ€å¹¶æ›´æ–°æˆ‘ä»¬çš„useEffectã€‚

```js
function StopWatch() {
  const [time, setTime] = useState(0);
  const [ticking, setTicking] = useState(false);

  useEffect(() => {
    if (ticking) {
      const interval = setInterval(() => {
        setTime((ms) => ms + 1)
      }, 1000);
      return () => clearInterval(interval);
    } else {
      // ğŸ¤” but we don't have access "interval" here
      clearInterval(interval)
    }
  }, [ticking]);

  return (
    <div>
      <div>{time}</div>
      <button onClick={() => setTicking(c => !c)}>{ticking ? 'Pause' : 'Resume'}</button>
    </div>
  )
}
```

é‚£ä¹ˆï¼Œæˆ‘ä»¬ç°åœ¨åœ¨å“ªé‡Œæ”¾ç½®é—´éš”ï¼Ÿå¦‚æœå°†å…¶æ”¾ç½®`useEffect`åœ¨æ¯ä¸ªæ¸²æŸ“å™¨çš„å¤–éƒ¨ï¼Œåˆ™æ‰€æœ‰å±€éƒ¨å˜é‡éƒ½å°†é‡ç½®ï¼Œå¹¶ä¸”å°†å†æ¬¡å˜ä¸ºæœªå®šä¹‰

```js
function StopWatch() {
 ...
// I ğŸ‘‡ would keep becoming undefined on every re-render ğŸ˜¢
let interval;

useEffect ...
}
```

å› æ­¤ï¼Œç°åœ¨æˆ‘ä»¬å¸Œæœ›æŸäº›ä¸œè¥¿åœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­ä¿æŒæŒä¹…æ€§ï¼Œå¹¶ä¸”ä¸ä¼šå¼•èµ·é‡æ–°æ¸²æŸ“ï¼Œè€Œæ‚¨çŒœå¯¹äº†ï¼Œæˆ‘ä»¬è¿™é‡Œéœ€è¦useRefã€‚

```js
function StopWatch() {
  const [time, setTime] = useState(0)
  const [ticking, setTicking] = useState(false)
  // mutable and persistant 
  const interval = useRef()

  useEffect(() => {
    if (ticking) {
      // `interval` would not reset when component re-renders
      interval.current = setInterval(() => {
        setTime((ms) => ms + 1)
      }, 1000)
      return () => clearInterval(interval.current)
    } else {
      // and now you have access to the interval
      interval.current && clearInterval(interval.current)
    }
  }, [ticking])

  return (
    <div className="App">
      <h1>{time}</h1>
      <button onClick={() => setTicking(c => !c)}>
        {time === 0 ? 'Start' : ticking ? 'Pause' : 'Resume'}
      </button>
    </div>
  )
}
```

ç„¶åå»å“ªå„¿ï¼Ÿä»ç°åœ¨å¼€å§‹ï¼Œæ‚¨å¯ä»¥é˜…è¯»æœ‰å…³[è½¬å‘ref](https://reactjs.org/docs/forwarding-refs.html)å’Œ[useImperativeHandleçš„](https://reactjs.org/docs/hooks-reference.html#useimperativehandle)æ›´å¤š